# 《逆塔回响》游戏机制说明文档

> **状态**: 待确认 (NeedsConfirm)  
> **版本**: v0.1 (补充模板)  
> **最后更新**: 2026-01-08

---

## 1. 战斗系统

### 1.1 基础战斗公式 (已确认)

```
玩家每回合伤害 = max(ATK - 敌DEF, 0)
敌人每回合伤害 = max(敌ATK - DEF, 0)
回合数 = ceil(敌HP / 玩家每回合伤害)
预计损失HP = (回合数 - 1) × 敌人每回合伤害
```

**注意**: 若 `玩家每回合伤害 = 0`，则该敌人不可战胜。

### 1.2 特殊机制详解 (待确认)

| 机制 | 参数 | 实现逻辑 | 确认状态 |
|------|------|----------|----------|
| **FirstStrike** | 0 或 1 | 敌人先手攻击，额外造成 `(参数+1)` 次伤害？ | ❓ 待确认 |
| **Drain** | N | 每回合吸血 N 点 (敌人回复 N HP？还是玩家额外损失 N HP？) | ❓ 待确认 |
| **IgnoreDEF** | - | 敌人攻击无视玩家 DEF，伤害 = 敌ATK | ❓ 待确认 |
| **CurseATK** | N | 战斗结束后玩家 ATK-N (是否有下限？是否可叠加？) | ❓ 待确认 |
| **HighDEF** | - | 标记型，无特殊逻辑，仅提示玩家该敌人高防 | ❓ 待确认 |
| **Thorns** | N | 玩家每次攻击受到 N 点反伤 | ❓ 待确认 |
| **BuffEveryN** | N:+MATK | 每 N 回合敌人 ATK+M (30F Boss 专属) | ❓ 待确认 |

### 1.3 战斗流程 (待确认)

```
1. 玩家触碰敌人格子
2. 显示战斗预览 (预计损失HP)
3. 若玩家ATK <= 敌DEF: 显示"无法战胜"
4. 若玩家HP <= 预计损失HP: 显示"警告：将会死亡"？
5. 玩家确认战斗 / 自动战斗？
6. 执行战斗计算
7. 扣除玩家HP，获得Gold
8. 敌人消失，格子变为Floor
```

**待确认**:
- [ ] 是否有战斗确认界面？
- [ ] 是否自动战斗（触碰即战斗）？
- [ ] 战斗动画/演出时长？

---

## 2. 移动与交互

### 2.1 移动方式 (待确认)

| 项目 | 选项A | 选项B | 确认状态 |
|------|-------|-------|----------|
| 移动模式 | 四方向 (上下左右) | 八方向 (含对角) | ❓ |
| 输入方式 | 键盘方向键/WASD | 鼠标点击 | ❓ |
| 移动速度 | 即时移动 | 动画过渡 | ❓ |

### 2.2 交互逻辑 (待确认)

| 对象 | 交互方式 | 效果 |
|------|----------|------|
| 敌人 (Enemy) | 移动进入格子 | 触发战斗 |
| 道具 (Item) | 移动进入格子 | 自动拾取 |
| NPC | 移动进入格子 / 面对按键 | 触发对话 |
| 门 (Door) | 移动进入格子 | 消耗钥匙开门 |
| 楼梯上 (StairUp) | 移动进入格子 | 前往上一层 |
| 楼梯下 (StairDown) | 移动进入格子 | 前往下一层 |
| 墙 (Wall) | 移动进入格子 | 阻挡，无法进入 |

---

## 3. 楼层系统

### 3.1 楼层切换 (待确认)

| 项目 | 选项 | 确认状态 |
|------|------|----------|
| 是否可返回下层 | 是 / 否 | ❓ |
| 楼层状态保存 | 保存 / 重置 | ❓ |
| 敌人重生 | 是 / 否 | ❓ |
| 道具重生 | 是 / 否 | ❓ |

### 3.2 楼层可见性 (待确认)

| 项目 | 选项 | 确认状态 |
|------|------|----------|
| 迷雾系统 | 有 / 无 | ❓ |
| 小地图 | 有 / 无 | ❓ |
| 敌人信息显示 | 悬停显示 / 始终显示 / 隐藏 | ❓ |

---

## 4. 存档系统 (待确认)

| 项目 | 选项 | 确认状态 |
|------|------|----------|
| 存档方式 | 自动存档 / 手动存档 / 存档点 | ❓ |
| 存档槽位 | 单槽位 / 多槽位 (数量?) | ❓ |
| 存档时机 | 每步 / 每层 / 手动 | ❓ |
| 读档限制 | 无限制 / 有限次数 / 消耗道具 | ❓ |

---

## 5. 死亡与重生 (待确认)

| 项目 | 选项 | 确认状态 |
|------|------|----------|
| 死亡条件 | HP <= 0 | ✅ |
| 死亡后处理 | 游戏结束 / 读取存档 / 原地复活 | ❓ |
| 是否有复活道具 | 是 / 否 | ❓ |

---

## 6. 结局系统 (待确认)

### 6.1 结局条件

| 结局 | 触发条件 | 确认状态 |
|------|----------|----------|
| 普通结局 | 通关30F | ❓ |
| 理性结局 | 通关30F + 未使用"时之沙" | ❓ |
| 极限结局 | 通关30F + ATK+DEF >= ? | ❓ 阈值待确认 |
| 真结局 | 通关31F+ + 收集全部记录碑 + NPC存活 | ❓ |

### 6.2 极限结局阈值 (待确认)

```
ATK + DEF >= ???
```

---

## 7. UI/UX 设计 (待确认)

### 7.1 主界面布局

```
+----------------------------------+
|  HP: ???   ATK: ??   DEF: ??     |  <- 状态栏
|  Gold: ????                       |
|  钥匙: Y:? B:? R:?               |
+----------------------------------+
|                                  |
|          9x9 地图区域             |
|                                  |
+----------------------------------+
|  [菜单] [地图] [背包] [存档]     |  <- 功能按钮
+----------------------------------+
```

### 7.2 战斗预览界面 (待确认)

```
+---------------------------+
|  敌人: [名称]              |
|  HP: ???  ATK: ??  DEF: ?? |
|  预计损失: ??? HP          |
|  获得金币: ???             |
+---------------------------+
```

---

## 8. 数值修正记录

### 8.1 疑似 OCR 错误

| 位置 | 原始值 | 推测正确值 | 状态 |
|------|--------|------------|------|
| 15F (2,4) | Item 10114 | Item 1011 (防御宝石) | ❓ |
| 27F (4,6) | Item 10114 | Item 1011 (防御宝石) | ❓ |

---

## 9. 待补充清单

- [ ] 商店交互流程
- [ ] 背包系统设计
- [ ] 成就系统
- [ ] 统计数据 (步数、战斗次数等)
- [ ] 音效配置表
- [ ] BGM 配置表
- [ ] 美术资源清单

---

## 更新日志

| 日期 | 版本 | 内容 |
|------|------|------|
| 2026-01-08 | v0.1 | 初始模板创建 |
